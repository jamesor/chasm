/*!
 * chasm v0.1.1 (https://github.com/jamesor/chasm.git)
 * A browser-based text adventure game engine
 * Copyright 2015 James O'Reilly
 * Licensed under the MIT license
 */"use strict";function _typeof(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _get=function t(e,i,n){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,i);if(void 0===s){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,i,n)}if("value"in s)return s.value;var r=s.get;if(void 0!==r)return r.call(n)},_createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();Array.prototype.toDictionary=function(){var t={};return this.forEach(function(e){return t[e]=!0}),t},String.prototype.sizeTo=function(t,e){return(this+new Array(t+1).join(e||" ")).substr(0,t)},String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.toDictionary=function(){return this.split(",").toDictionary()},"undefined"==typeof Object.values&&(Object.values=function(t){return Object.keys(t).map(function(e){return t[e]})});var PrepLookup=Object.freeze({tie:["to","around"],untie:["from"],take:["from"],put:["in","into","on"],unlock:["with"],lock:["with"],take:["from"],"pick up":["from"],get:["from"],open:["with"]}),Events=Object.freeze({GAME_START:"game/start",PLACE_CHANGED:"place/changed",PLAYER_SCORE:"player/score",PLAYER_SCORED:"player/scored",PLAYER_MOVE:"player/move",PLAYER_MOVED:"player/moved",OUTPUT_WRITE:"output/write",OUTPUT_WRITELN:"output/writeln",OUTPUT_CLEAR:"output/clear",INPUT_WRITE:"input/write",INPUT_CLEAR:"input/clear",INPUT_PROMPT:"input/prompt"}),nArticles=Object.freeze("a,an,the".toDictionary()),nTwoWordVerbs=Object.freeze("pick up,put down,look in,look at".toDictionary()),InputUtils=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"tokenize",value:function(t){for(var e,i=t.split(/\s+/),n=i.length-1;n>=0;n--)if(e=i[n],nArticles[e])i.splice(n,1);else{if(!nVocabulary[e])return"I don't know the word "+e;i.length>n&&(e+=" "+i[n+1],(nItems[e]||nTwoWordVerbs[e])&&(i[n]=e,i.splice(n+1,1)))}return 0===i.length?"I beg your pardon?":i}},{key:"parse",value:function(t){var e,i,n,s=t[0],o=PrepLookup[s],r=t[1]?ItemsProxy.findAll(t[1]):null,u=t[2]&&o&&-1!==o.indexOf(t[2])?t[2]:null,a=t[3]?ItemsProxy.findAll(t[3]):null;return r&&(e=r.item,n=r.output),a&&(i=a.item,n=n||a.output),u=u||o?o[0]:null,{verb:s,noun1:r,prep:u,noun2:a,item:e,target:i,output:n}}},{key:"testVerb",value:function(t){return t.item?void 0:"What do you want to "+t.verb+"?"}},{key:"testNoun1",value:function(t){return t.noun1&&t.noun1.output?t.noun1.output:void 0}},{key:"testPrep",value:function(t){return t.prep?void 0:"What do you want to "+t.verb+" the "+t.noun1.term+" "+t.validPrep+"?"}},{key:"testNoun2",value:function(t){return t.noun2?t.noun2.output?t.noun2.output:t.item===t.target?"I should recurse infinitely to teach you a lesson, but...":void 0:"What do you want to "+t.verb+" the "+t.noun1.term+" "+t.prep+"?"}},{key:"getAlreadyDoneResponse",value:function(){var t=["I think you've already done that.","You think it isn't?","Look around."];return t[MathUtils.getRandomInt(0,t.length)]}},{key:"testAction",value:function(t){var e=t.item.canDo(t.verb);return"string"==typeof e?e:e===!1?"The "+t.noun1.term+" isn't something you can "+t.verb+".":void 0}},{key:"testActionWithTarget",value:function(t){return t.item.canDoWith(t.verb,t.target.title)?void 0:"You cannot "+t.verb+" the "+t.noun1.term+" "+t.prep+" the "+t.noun2.term+"."}},{key:"testVerbItem",value:function(e){return t.testVerb(e)||t.testNoun1(e)||t.testAction(e)}},{key:"testVerbItemWithTarget",value:function(e){return t.testVerb(e)||t.testNoun1(e)||t.testPrep(e)||t.testNoun2(e)||t.testActionWithTarget(e)}}]),t}(),MathUtils=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"getRandomBoolean",value:function(){return!!Math.floor(2*Math.random())}},{key:"getRandom",value:function(){return Math.random()}},{key:"getRandomArbitrary",value:function(t,e){return Math.random()*(e-t)+t}},{key:"getRandomInt",value:function(t,e){return Math.floor(Math.random()*(e-t))+t}},{key:"getRandomIntInclusive",value:function(t,e){return Math.floor(Math.random()*(e-t+1))+t}}]),t}(),ItemsProxy=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"findAll",value:function(t){var e=chasm.player.findItems(t),i=chasm.place.findItems(t),n=[].concat(_toConsumableArray(e),_toConsumableArray(i)),s=null,o="";return 0===n.length?o="You do not see the "+t+" here.":1===n.length?s=n[0]:n.length>1&&(o="Which "+t+" did you mean?"),{term:t,item:s,output:o}}}]),t}(),BaseApp=function(){function t(e){_classCallCheck(this,t),this.initModels(e),this.initControllers(e),this.initCommands(e),this.subscribe(Events.GAME_START,this.startGame,this,!0)}return _createClass(t,[{key:"registerCommand",value:function(t,e,i){this.topics.has(t)||this.topics.set(t,[]),this.topics.get(t).push({cmd:e,fireOnce:i})}},{key:"subscribe",value:function(t,e,i,n){this.topics.has(t)||this.topics.set(t,[]),this.topics.get(t).push({fn:e,cxt:i,fireOnce:n})}},{key:"unsubscribe",value:function(t,e,i){this.topics.has(t)&&this.topics.get(t).length>0&&console.warn("BaseApp.unsubscribe() not yet implemented.")}},{key:"publish",value:function(t,e){var i=this;if(this.topics.has(t)&&this.topics.get(t).length>0)for(var n=void 0,s=this.topics.get(t),o=0,r=s.length;r>o;o++)n=s[o],n&&(n.cmd?new n.cmd(i,e).execute():n.cxt?n.fn.call(n.cxt,e):n.fn(e),n.fireOnce&&(s[o]=null))}},{key:"getRef",value:function(t){return"player"===t?this.player:this.refs.has(t)?this.refs.get(t):void console.error(t+" not found in chasm.getRef()")}},{key:"addRef",value:function(t){return this.refs.set(t.title,t),t}},{key:"removeRef",value:function(t){this.refs["delete"](t)}},{key:"initModels",value:function(t){var e=this;this.topics=new Map,this.commands=new Map,this.refs=new Map,this.items=new Map,this.player=new Player(this),this.scoreboard=new Scoreboard(this,t.points),t.items.forEach(function(t){return e.addRef(ItemFactory.create(e,t))}),t.places.forEach(function(t){return e.addRef(PlaceFactory.create(e,t))}),t.exits.forEach(function(t){return e.addRef(ExitFactory.create(e,t))}),this.place=this.getRef(t.startingLocation)}},{key:"initControllers",value:function(t){this.controllers=[new BannerController(this),new ImageController(this),new OutputController(this),new InputController(this),new KeyboardController(this)]}},{key:"initCommands",value:function(t){var e=this;this.registerCommand(Player.SCORE,ScoreCommand),this.registerCommand(Player.MOVE,MoveCommand),[CloseCommand,ExamineCommand,FooCommand,GoCommand,InventoryCommand,LockCommand,LookCommand,OpenCommand,PutCommand,TakeCommand,TieCommand,UnlockCommand,UntieCommand].forEach(function(t){return t.verbs().map(function(i){return e.registerCommand(i,t)})}),t.commands&&t.commands.forEach(function(t){return t.verbs().map(function(i){return e.registerCommand(i,t)})})}},{key:"startGame",value:function(){this.publish(Events.PLACE_CHANGED,this.place),this.publish(Events.OUTPUT_CLEAR),this.publish(Events.OUTPUT_WRITELN,this.place.describe()),this.publish(Events.INPUT_PROMPT,"&gt;")}}]),t}(),Entity=function(){function t(e,i){_classCallCheck(this,t),this.title=e||"Untitled",this.description=i||"Undescribed"}return _createClass(t,[{key:"restoreLongDescription",value:function(){this.tmpLongDescription&&(this._longDescription=this._tmpLongDescription)}},{key:"longDescription",get:function(){return this._longDescription},set:function(t){this._tmpLongDescription=this._longDescription,this._longDescription=t}}]),t}(),Item=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,i));return n.canBeTaken=!0,n.canHoldItems=!1,n._features=new Map([["examine",!0],["take",!0]]),n}return _inherits(e,t),_createClass(e,[{key:"setFeature",value:function(t,e){this._features.set(t,e)}},{key:"describe",value:function(){return this.description}},{key:"canDo",value:function(t){return"object"===_typeof(this._features.get(t))?"What would you like to "+t+" the "+this.title+" with?":this._features.get(t)}},{key:"canDoWith",value:function(t,e){return"object"===_typeof(this._features.get(t))?-1!==this._features.get(t).indexOf(e):this._features.get(t)}}]),e}(Entity),ItemFactory=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"create",value:function(e,i){var n;switch(i.type){case"Container":n=new Container(i.title,i.title);break;default:n=new Item(i.title,i.title)}return i.props&&Object.keys(i.props).forEach(function(t){return n[t]=i.props[t]}),i.features&&Object.keys(i.features).forEach(function(t){return n.setFeature(t,i.features[t])}),i.items&&i.items.forEach(function(i){return n.addItem(e.addRef(t.create(e,i)))}),n}}]),t}(),Container=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,i));return n._items=new Map,n.canHoldItems=!0,n.opened=!0,n._features.set("open",!0),n._features.set("close",!0),n}return _inherits(e,t),_createClass(e,[{key:"describe",value:function(t){var e=this.description;return t&&this.hasItems()&&(e+=" with "+this.itemsToSentence()),e}},{key:"lookInside",value:function(){return this.canHoldItems?this.opened?this.itemsToList():"The "+this.title+" is closed.":"The "+this.title+" can't contain other objects."}},{key:"addItem",value:function(t){return this.canHoldItems&&t&&(t.parent=this.title,this._items.set(t.title,t)),this}},{key:"removeItem",value:function(t){return this._items["delete"](t.title),this}},{key:"hasItem",value:function(t){return this._items.has(t)}},{key:"hasItems",value:function(){return this._items.size>0}},{key:"findItems",value:function(t){function e(n){n&&n.forEach(function(n){(n.title===t||n.commonTitle===t)&&i.push(n),n.opened&&e(n._items)})}var i=[];return e(this._items),i}},{key:"itemsToList",value:function(){function t(e,i){var n="";return 0===e.size?n:(e.forEach(function(e){e.hideFromList||(n+=i+e.description.capitalizeFirstLetter(),n+=i?"":" is here.",n+="<br>",e.canHoldItems&&e.opened&&e.hasItems()&&(n+=i+("The "+e.title+" contains:<br>"),n+=t(e._items,i+"&nbsp;")))}),n)}return t(this._items,"")}},{key:"itemsToSentence",value:function(){var t,e="",i=[];return this._items.size>0&&(this._items.forEach(function(t){return i.push(t.description)}),t=i.pop(),e=(i.length>0?i.join(", ")+" and ":"")+t),e}},{key:"itemsToArray",value:function(){return this._items.values()}}]),e}(Item),Exit=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,t));return i._places=new Map,i.opened=!0,i.blocked=!1,i.setFeature("take",!1),i}return _inherits(e,t),_createClass(e,[{key:"addPlace",value:function(t,e){this._places.set(t,e)}},{key:"getPlace",value:function(t){return this._places.get(t)}}]),e}(Item),DooredExit=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return i.commonTitle="door",i.opened=!1,i.closedMessage="The "+i.title+" is closed.",i._features.set("open",!0),i._features.set("close",!0),i}return _inherits(e,t),_createClass(e,[{key:"getPlace",value:function(t){return this.opened?_get(Object.getPrototypeOf(e.prototype),"getPlace",this).call(this,t):!1}}]),e}(Exit),LockedExit=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t));return i.locked=!0,i.unlockedMessage="Locked.",i.lockedMessage="The door is locked.",i}return _inherits(e,t),_createClass(e,[{key:"getPlace",value:function(t){return this.isLocked?this.lockedMessage:_get(Object.getPrototypeOf(e.prototype),"getPlace",this).call(this,t)}}]),e}(DooredExit),ExitFactory=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"create",value:function(t,e){var i,n=e.title,s=e.places;switch(e.type){case"DooredExit":i=new DooredExit(e.title);break;case"LockedExit":i=new LockedExit(n);break;default:i=new Exit(n)}if(i&&s&&2===s.length){var o=s[0],r=s[1],u=t.getRef(o.place),a=t.getRef(r.place);i.addPlace(o.dir,u),i.addPlace(r.dir,a),u.addExit(r.dir,i),a.addExit(o.dir,i)}else console.error("Invalid args: Exit.create()");return i.blocked=!!e.blocked,i}}]),t}(),Place=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t.title,t.description));return i.canBeTaken=!1,i.visited=!1,i._exits=new Map,i}return _inherits(e,t),_createClass(e,[{key:"addExit",value:function(t,e){return this._exits.set(t,e),this}},{key:"look",value:function(){return"<strong>"+this.title+"</strong><br>"+this.description+"<br>"+this.itemsToList()}},{key:"describe",value:function(){return this.visited?"<strong>"+this.title+"</strong><br>"+this.itemsToList():(this.visited=!0,this.look())}},{key:"findItems",value:function(t){var i=_get(Object.getPrototypeOf(e.prototype),"findItems",this).call(this,t);return this._exits.forEach(function(e){(e.title===t||e.commonTitle===t)&&i.push(e)}),i}},{key:"getExit",value:function(t){return this._exits.get(t)}},{key:"imageSrc",get:function(){return"images/"+this.title.toLowerCase().replace(/ /g,"-")+".png"}}]),e}(Container),PlaceFactory=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"create",value:function(t,e){var i=new Place(e);return e.items&&e.items.forEach(function(e){return i.addItem(t.getRef(e))}),i}}]),t}(),Player=function(t){function e(t){_classCallCheck(this,e);var i=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,"player","You are an attractive adventurer with an athetic build."));return i.eventBus=t,i.canHoldItems=!0,i.moves=0,i}return _inherits(e,t),_createClass(e,[{key:"itemsToList",value:function(){var t;return 0===this._items.size?"You are empty handed.":(t="Your are carrying:<br>",this._items.forEach(function(e){t+="&nbsp;"+e.describe(!0).capitalizeFirstLetter()+"<br>"}),t)}}]),e}(Container),Scoreboard=function(){function t(e,i){var n=this;_classCallCheck(this,t),this.eventBus=e,this._score=0,this._points=new Map,Object.keys(i).forEach(function(t){return n._points.set(t,i[t])})}return _createClass(t,[{key:"scorePoints",value:function(t){var e=this._points.get(t)||0;e>0&&(this._score+=e,this._points["delete"](t),this.eventBus.publish(Events.PLAYER_SCORED,this._score))}}]),t}(),ImageView=function(){function t(){_classCallCheck(this,t),this.el=document.getElementById("image")}return _createClass(t,[{key:"imageSrc",set:function(t){this.el.style["background-image"]="url("+t+")"}}]),t}(),OutputView=function(){function t(){_classCallCheck(this,t),this.el=document.getElementById("output")}return _createClass(t,[{key:"clear",value:function(){this.el.innerHTML=""}},{key:"write",value:function(t){this.el.innerHTML+=t,this.el.scrollTop=this.el.scrollHeight}}]),t}(),TextView=function(){function t(e,i,n){_classCallCheck(this,t),this.el=document.getElementById(e),this.len=n||0,this.text=i||""}return _createClass(t,[{key:"text",set:function(t){var e=t+"";this.len&&(e=e.sizeTo(this.len)),this.el.innerHTML=e.replace(/ /g,"&nbsp;")}}]),t}(),BasicInput=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"processInput",value:function(t,e){var i=e.toLowerCase().trim();if(t.publish(Events.OUTPUT_WRITE,'&nbsp;&nbsp;&nbsp;&nbsp;**** COMMODORE 64 BASIC V2 ****<br><br>&nbsp;64K RAM SYSTEM &nbsp;38911 BASIC BYTES FREE<br><br>READY.<br>LOAD "CHASM",8,1<br><br>SEARCHING FOR CHASM<br>LOADING<br>READY.<br>'),t.publish(Events.INPUT_CLEAR),"run"===i){var n=document.querySelectorAll(".upper")[0];n.className=(""+n.className).replace("upper","");var s=document.getElementById("screen");s.className=s.className+" game",t.publish(Events.GAME_START)}}}]),t}(),GameInput=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"processInput",value:function(t,i){var n=i.toLowerCase().trim();t.publish(Events.OUTPUT_WRITE,">"+n+"<br>"),t.publish(Events.INPUT_CLEAR);var s=InputUtils.tokenize(n);"object"===("undefined"==typeof s?"undefined":_typeof(s))?(t.publish(s[0],s),t.publish(Events.PLAYER_MOVE)):t.publish(Events.OUTPUT_WRITELN,e.message)}}]),t}(),BannerController=function(){function t(e){_classCallCheck(this,t),this.eventBus=e,this.placeView=new TextView("place","Start",21),this.scoreView=new TextView("score","Score:0",9),this.movesView=new TextView("moves","Moves:0",10),e.subscribe(Events.PLACE_CHANGED,this.onPlaceChanged,this),e.subscribe(Events.PLAYER_SCORED,this.onUserScored,this),e.subscribe(Events.PLAYER_MOVED,this.onUserMoved,this)}return _createClass(t,[{key:"onPlaceChanged",value:function(t){this.placeView.text=t.title}},{key:"onUserScored",value:function(t){this.scoreView.text="Score:"+t}},{key:"onUserMoved",value:function(t){this.movesView.text="Moves:"+t}},{key:"destroy",value:function(){this.eventBus.unsubscribe(Events.PLACE_CHANGED,this.onPlaceChanged,this),this.eventBus.unsubscribe(Events.PLAYER_SCORED,this.onUserScored,this),this.eventBus.unsubscribe(Events.PLAYER_MOVED,this.onUserMoved,this)}}]),t}(),ImageController=function(){function t(e){_classCallCheck(this,t),this.eventBus=e,this.view=new ImageView,e.subscribe(Events.PLACE_CHANGED,this.onPlaceChanged,this)}return _createClass(t,[{key:"onPlaceChanged",value:function(t){this.view.imageSrc=t.imageSrc}},{key:"destroy",value:function(){this.eventBus.unsubscribe(Events.PLACE_CHANGED,this.onPlaceChanged,this)}}]),t}(),InputController=function(){function t(e){_classCallCheck(this,t),this.eventBus=e,this.promptView=new TextView("prompt"),this.responseView=new TextView("response"),e.subscribe(Events.INPUT_WRITE,this.onWrite,this),e.subscribe(Events.INPUT_CLEAR,this.onClear,this),e.subscribe(Events.INPUT_PROMPT,this.onPrompt,this)}return _createClass(t,[{key:"onWrite",value:function(t){this.responseView.text=t}},{key:"onClear",value:function(){this.responseView.text=""}},{key:"onPrompt",value:function(t){this.promptView.text=t}},{key:"destroy",value:function(){this.eventBus.unsubscribe(Events.INPUT_WRITE,this.onWrite,this),this.eventBus.unsubscribe(Events.INPUT_CLEAR,this.onClear,this),this.eventBus.unsubscribe(Events.INPUT_PROMPT,this.onPrompt,this)}}]),t}(),KeyboardController=function(){function t(e){_classCallCheck(this,t),this.eventBus=e,this._inputBuffer="",this.delegate=new BasicInput,document.addEventListener("keydown",this.onKeydown.bind(this)),document.addEventListener("keypress",this.onKeypress.bind(this)),e.subscribe(Events.GAME_START,this.onGameStart,this,!0),setTimeout(this.processInput.bind(this),300)}return _createClass(t,[{key:"processInput",value:function(){this.delegate.processInput(this.eventBus,this._inputBuffer)}},{key:"onGameStart",value:function(){this.delegate=new GameInput}},{key:"onKeydown",value:function(t){var e=8,i=13,n=32;switch(t.which){case e:t.preventDefault(),this._inputBuffer=this._inputBuffer.substring(0,this._inputBuffer.length-1),this.eventBus.publish(Events.INPUT_WRITE,this._inputBuffer);break;case i:t.preventDefault(),this.processInput(),this._inputBuffer="",this.eventBus.publish(Events.INPUT_WRITE,this._inputBuffer);break;case n:t.preventDefault(),this._inputBuffer+=" ",this.eventBus.publish(Events.INPUT_WRITE,this._inputBuffer)}}},{key:"onKeypress",value:function(t){var e=39;this._inputBuffer.length<e&&(this._inputBuffer+=String.fromCharCode(t.which),this.eventBus.publish(Events.INPUT_WRITE,this._inputBuffer))}}]),t}(),OutputController=function(){function t(e){_classCallCheck(this,t),this.eventBus=e,this.view=new OutputView,e.subscribe(Events.OUTPUT_WRITE,this.onWrite,this),e.subscribe(Events.OUTPUT_WRITELN,this.onWriteLine,this),e.subscribe(Events.OUTPUT_CLEAR,this.onClear,this)}return _createClass(t,[{key:"onWrite",value:function(t){this.view.write(t)}},{key:"onWriteLine",value:function(t){this.view.write("<p>"+t+"</p>")}},{key:"onClear",value:function(){this.view.clear()}},{key:"destroy",value:function(){this.eventBus.unsubscribe(Events.OUTPUT_WRITE,this.onWrite,this),this.eventBus.unsubscribe(Events.OUTPUT_WRITELN,this.onWriteLine,this),this.eventBus.unsubscribe(Events.OUTPUT_CLEAR,this.onClear,this)}}]),t}(),BaseCommand=function(){function t(e,i){_classCallCheck(this,t),this.game=e,this.data=i}return _createClass(t,[{key:"execute",value:function(){this.output||(this.output="I don't understand that sentence."),this.game.publish(Events.OUTPUT_WRITELN,this.output),this.action&&(this.game.publish(Player.SCORE,this.action),this.game.publish(this.action))}}],[{key:"verbs",value:function(){return[]}}]),t}(),BaseActionCommand=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,i)),s=InputUtils.parse(i);return n.verb=s.verb=n.__proto__.constructor.verbs()[0],n.item=s.item,n.prep=s.prep,n.target=s.target,n.noun1=s.noun1,n.noun2=s.noun2,n.output=s.output,n.output||(n.target?(n.output=InputUtils.testVerbItemWithTarget(s),n.action=n.verb+"/"+n.item.title+"/"+n.target.title):(n.output=InputUtils.testVerbItem(s),n.action=n.verb+"/"+n.item.title)),n}return _inherits(e,t),e}(BaseCommand),CloseCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){return this.output||this.item.opened||(this.output=InputUtils.getAlreadyDoneResponse()),this.output?void this.game.publish(Events.OUTPUT_WRITELN,this.output):(this.item.opened=!1,this.output="You closed the "+this.item.title+".",void _get(Object.getPrototypeOf(e.prototype),"execute",this).call(this))}}],[{key:"verbs",value:function(){return["close"]}}]),e}(BaseActionCommand),ExamineCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){return this.output||this.item.longDescription||(this.output="You see nothing special about the "+this.item.title+"."),this.output?void this.game.publish(Events.OUTPUT_WRITELN,this.output):(this.output=this.item.longDescription,void _get(Object.getPrototypeOf(e.prototype),"execute",this).call(this))}}],[{key:"verbs",value:function(){return["examine","look at"]}}]),e}(BaseActionCommand),FooCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){return 1===this.data.length?void this.game.publish(Events.OUTPUT_WRITELN,"Well, FOO, BAR, and BLETCH to you too!"):void this.game.publish(Events.OUTPUT_WRITELN,"I only understood you as far as wanting to foo.")}}],[{key:"verbs",value:function(){return["foo"]}}]),e}(BaseCommand),GoCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){var t,e=this.data[0],i="You can't go that way.";if(("walk"===e||"go"===e)&&2===this.data.length&&(e=this.data[1]),e=e.charAt(0),e&&(t=this.game.place.getExit(e)))if(t.blocked)i="You can't go that way... yet.";else if(t.opened)if(t.locked)i=t.lockedMessage;else{var n=t.getPlace(e);n&&(this.game.place=n,this.game.publish(Events.PLACE_CHANGED,n),i=n.describe())}else i=t.closedMessage;this.game.publish(Events.OUTPUT_WRITELN,i)}}],[{key:"verbs",value:function(){return["n","s","e","w","u","d","north","south","east","west","up","down","go","walk","run"]}}]),e}(BaseCommand),InventoryCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){this.game.publish(Events.OUTPUT_WRITELN,this.game.player.itemsToList())}}],[{key:"verbs",value:function(){return["i","inventory"]}}]),e}(BaseCommand),LockCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){return this.output||this.item.locked&&(this.output="The "+this.item.title+" is already locked."),this.output?void this.game.publish(Events.OUTPUT_WRITELN,this.output):(this.item.locked=!0,this.output="You locked the "+this.item.title+".",void _get(Object.getPrototypeOf(e.prototype),"execute",this).call(this))}}],[{key:"verbs",value:function(){return["lock"]}}]),e}(BaseActionCommand),LookCommand=function(t){function e(t,i){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,Object.getPrototypeOf(e).call(this,t,i)),s=InputUtils.parse(i);return n.verb=s.verb,n.item=s.item,n.noun1=s.noun1,n.noun1?(n.output=InputUtils.testVerbItem(s),n.action=n.verb+"/"+n.item.title):n.output=InputUtils.testVerb(s),n}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){switch(this.verb){case"l":case"look":this.output=this.game.place.look();break;case"look in":var t=ItemsProxy.findAll(this.noun1.term);this.output=t.item?t.item.lookInside():t.output;break;default:this.output="I don't understand that sentence."}this.game.publish(Events.OUTPUT_WRITELN,this.output)}}],[{key:"verbs",value:function(){return["l","look","look in"]}}]),e}(BaseCommand),MoveCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){this.game.player.moves++,this.game.publish(Events.PLAYER_MOVED,this.game.player.moves)}}]),e}(BaseCommand),OpenCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){return this.output||(this.item.locked?this.output="The "+this.item.title+" is locked.":this.item.opened&&(this.output=InputUtils.getAlreadyDoneResponse())),this.output?void this.game.publish(Events.OUTPUT_WRITELN,this.output):(this.item.opened=!0,this.output="You opened the "+this.item.title,this.item.canHoldItems&&this.item.hasItems()&&(this.output+=", revealing "+this.item.itemsToSentence()),this.output=this.output+".",void _get(Object.getPrototypeOf(e.prototype),"execute",this).call(this))}}],[{key:"verbs",value:function(){return["open"]}}]),e}(BaseActionCommand),PutCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){var t;return this.output||(this.target?this.item.canBeTaken?this.target.canHoldItems?this.item.opened?t="You "+this.verb+" the "+this.item.title+" "+this.prep+" the "+this.target.title+".":output="The "+this.item.title+" is closed.":this.output="That can't contain things.":this.output="You cannot take the "+this.item.title+".":(this.target=this.game.place,t=this.item.title.capitalizeFirstLetter()+" dropped.")),this.output?void this.game.publish(Events.OUTPUT_WRITELN,this.output):(this.game.getRef(this.item.parent).removeItem(this.item),this.target.addItem(this.item),this.output=t,void _get(Object.getPrototypeOf(e.prototype),"execute",this).call(this))}}],[{key:"verbs",value:function(){return["put","drop"]}}]),e}(BaseCommand),ScoreCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){this.game.scoreboard.scorePoints(this.data)}}]),e}(BaseCommand),TakeCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){return this.output||this.game.player.hasItem(this.item.title)&&(this.output="You already have the "+this.item.title+"."),this.output?void this.game.publish(Events.OUTPUT_WRITELN,this.output):(this.game.getRef(this.item.parent).removeItem(this.item),this.game.player.addItem(this.item),this.output=this.item.title.capitalizeFirstLetter()+" taken.",void _get(Object.getPrototypeOf(e.prototype),"execute",this).call(this))}}],[{key:"verbs",value:function(){return["take","get","pick up"]}}]),e}(BaseActionCommand),TieCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){return this.output||this.item.tiedTo&&(this.output="The "+this.item.title+" is already tied to something."),this.output?void this.game.publish(Events.OUTPUT_WRITELN,this.output):(this.target.longDescription=this.target.longDescription+" "+this.item.title.capitalizeFirstLetter()+" is securely fastened around it.",this.item.tiedTo=this.target,this.item.setFeature("take",!1),this.game.player.removeItem(this.item),this.game.place.addItem(this.item),this.output="The "+this.item.title+" is now securely fastened to the "+this.target.title+".",void _get(Object.getPrototypeOf(e.prototype),"execute",this).call(this))}}],[{key:"verbs",value:function(){return["tie","wrap"]}}]),e}(BaseActionCommand),UnlockCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){return this.output||this.item.locked||(this.output="The "+this.item.title+" is already unlocked."),this.output?void this.game.publish(Events.OUTPUT_WRITELN,this.output):(this.item.locked=!1,this.output="You unlocked the "+this.item.title+".",void _get(Object.getPrototypeOf(e.prototype),"execute",this).call(this))}}],[{key:"verbs",value:function(){return["unlock"]}}]),e}(BaseActionCommand),UntieCommand=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,Object.getPrototypeOf(e).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"execute",value:function(){return this.output||(this.item.tiedTo?this.item.tiedTo!==this.target&&(this.output="The "+this.item.title+" is not tied to the "+target.title):this.output="The "+this.item.title+" is not tied to anything."),this.output?void this.game.publish(Events.OUTPUT_WRITELN,this.output):(this.target.restoreLongDescription(),this.item.tiedTo=null,this.item.setFeature("take",!0),this.game.place.removeItem(this.item),this.game.player.addItem(this.item),this.output="You've untied the "+this.item.title+" from the "+this.target.title+" and have taken it.",void _get(Object.getPrototypeOf(e.prototype),"execute",this).call(this))}}],[{key:"verbs",value:function(){return["untie","unwrap"]}}]),e}(BaseActionCommand);